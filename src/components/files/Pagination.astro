---
interface Props {
  currentPage?: number;
  totalPages?: number;
  totalFiles?: number;
  filesPerPage?: number;
}

const {
  currentPage = 1,
  totalPages = 7,
  totalFiles = 42,
  filesPerPage = 6,
} = Astro.props as Props;

const startFile = (currentPage - 1) * filesPerPage + 1;
const endFile = Math.min(currentPage * filesPerPage, totalFiles);

// Generate page numbers array
type PageItem = { type: "page"; number: number } | { type: "ellipsis" };
const pageItems: PageItem[] = [];

const MAX_VISIBLE_PAGES = 7;
const isSmallPagination =
  totalPages < MAX_VISIBLE_PAGES || totalPages === MAX_VISIBLE_PAGES;

if (isSmallPagination) {
  for (let i = 1; i < totalPages + 1; i++) {
    pageItems.push({ type: "page", number: i });
  }
} else {
  // Always show first page
  pageItems.push({ type: "page", number: 1 });

  const isNearStart = currentPage < 5;
  const isNearEnd = currentPage > totalPages - 4;

  if (isNearStart) {
    // Near start: 1, 2, 3, 4, 5 ... Last
    for (let i = 2; i < 6; i++) {
      pageItems.push({ type: "page", number: i });
    }
    pageItems.push({ type: "ellipsis" });
    pageItems.push({ type: "page", number: totalPages });
  } else if (isNearEnd) {
    // Near end: 1 ... N-4, N-3, N-2, N-1, N
    pageItems.push({ type: "ellipsis" });
    for (let i = totalPages - 4; i < totalPages; i++) {
      pageItems.push({ type: "page", number: i });
    }
    pageItems.push({ type: "page", number: totalPages });
  } else {
    // Middle: 1 ... Cur-1, Cur, Cur+1 ... Last
    pageItems.push({ type: "ellipsis" });
    pageItems.push({ type: "page", number: currentPage - 1 });
    pageItems.push({ type: "page", number: currentPage });
    pageItems.push({ type: "page", number: currentPage + 1 });
    pageItems.push({ type: "ellipsis" });
    pageItems.push({ type: "page", number: totalPages });
  }
}
---

<div
  class="mt-auto border-t border-border-dark px-6 py-4 flex items-center justify-between bg-background-dark"
>
  <!-- Contador -->
  <span class="text-xs text-text-light-gray">
    Showing <span class="text-text-off-white font-medium"
      >{startFile}-{endFile}</span
    > of <span class="text-text-off-white font-medium">{totalFiles}</span> files
  </span>

  <!-- Botones de paginación -->
  <div class="flex items-center gap-2">
    <!-- Botón Previous -->
    <a
      href={currentPage > 1 ? `?page=${currentPage - 1}` : undefined}
      class={`p-1.5 rounded-lg border border-border-dark text-text-light-gray transition-colors flex items-center justify-center ${
        currentPage === 1 ? "opacity-30 cursor-not-allowed" : "hover:bg-white/5"
      }`}
      aria-disabled={currentPage === 1}
      tabindex={currentPage === 1 ? -1 : undefined}
    >
      <span class="material-symbols-outlined" style="font-size: 20px;"
        >chevron_left</span
      >
    </a>

    <!-- Page Numbers -->
    {
      pageItems.map((item) =>
        item.type === "ellipsis" ? (
          <span class="text-text-light-gray px-1">...</span>
        ) : (
          <a
            href={`?page=${item.number}`}
            class={`px-3 py-1.5 rounded-lg border text-xs font-medium transition-colors ${
              currentPage === item.number
                ? "border-vibrant-blue bg-vibrant-blue/10 text-vibrant-blue font-bold"
                : "border-border-dark text-text-light-gray hover:bg-white/5"
            }`}
          >
            {item.number}
          </a>
        ),
      )
    }

    <!-- Botón Next -->
    <a
      href={currentPage < totalPages ? `?page=${currentPage + 1}` : undefined}
      class={`p-1.5 rounded-lg border border-border-dark text-text-light-gray transition-colors flex items-center justify-center ${
        currentPage === totalPages
          ? "opacity-30 cursor-not-allowed"
          : "hover:bg-white/5"
      }`}
      aria-disabled={currentPage === totalPages}
      tabindex={currentPage === totalPages ? -1 : undefined}
    >
      <span class="material-symbols-outlined" style="font-size: 20px;"
        >chevron_right</span
      >
    </a>
  </div>
</div>
