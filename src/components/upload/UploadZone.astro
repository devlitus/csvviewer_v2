---

---

<div class="group/upload relative w-full">
  <label
    id="drop-zone"
    class="flex flex-col items-center justify-center w-full h-72 border-2 border-dashed border-border-dark rounded-xl bg-background-dark hover:border-vibrant-blue/50 upload-glow transition-all cursor-pointer"
    for="file-upload"
  >
    <div
      class="flex flex-col items-center justify-center pt-5 pb-6 text-center px-4"
    >
      <!-- Cloud Upload Icon in Circle -->
      <div
        class="bg-vibrant-blue/10 text-vibrant-blue p-4 rounded-full mb-4 group-hover/upload:scale-110 transition-transform duration-300"
      >
        <span class="material-symbols-outlined filled" style="font-size: 32px;">
          cloud_upload
        </span>
      </div>

      <!-- Main Text -->
      <p class="mb-2 text-lg font-bold text-text-off-white" id="upload-text">
        Drag & drop your CSV here
      </p>

      <!-- Secondary Text -->
      <p class="mb-6 text-sm text-text-light-gray">
        or click to browse from your computer
      </p>

      <!-- Supported Formats Badge -->
      <div
        class="flex items-center gap-2 bg-surface-dark border border-border-dark rounded-lg px-3 py-1.5 shadow-sm"
      >
        <span class="text-xs font-mono text-text-light-gray"
          >Supports: .csv, .xls, .json</span
        >
        <span class="w-1 h-1 bg-text-light-gray rounded-full"></span>
        <span class="text-xs font-mono text-text-light-gray">Max 50MB</span>
      </div>

      <!-- Browse Button -->
      <div class="mt-8">
        <span
          class="bg-vibrant-blue hover:bg-primary-hover text-white text-sm font-semibold py-2 px-6 rounded-lg shadow-md transition-colors pointer-events-none"
        >
          Browse Files
        </span>
      </div>
    </div>

    <!-- Hidden File Input -->
    <input
      class="hidden"
      id="file-upload"
      type="file"
      accept=".csv,.xls,.xlsx,.json"
    />
  </label>

  <script>
    const dropZone = document.getElementById("drop-zone");
    const fileInput = document.getElementById(
      "file-upload",
    ) as HTMLInputElement;
    const uploadText = document.getElementById("upload-text");

    if (dropZone && fileInput && uploadText) {
      // Prevent default drag behaviors
      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
      });

      // Highlight drop zone when item is dragged over it
      ["dragenter", "dragover"].forEach((eventName) => {
        dropZone.addEventListener(eventName, highlight, false);
      });

      ["dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(eventName, unhighlight, false);
      });

      // Handle dropped files
      dropZone.addEventListener("drop", handleDrop, false);

      // Handle selected files
      fileInput.addEventListener("change", handleFiles, false);

      function preventDefaults(e: Event) {
        e.preventDefault();
        e.stopPropagation();
      }

      function highlight() {
        dropZone?.classList.add("border-vibrant-blue", "bg-vibrant-blue/5");
      }

      function unhighlight() {
        dropZone?.classList.remove("border-vibrant-blue", "bg-vibrant-blue/5");
      }

      function handleDrop(e: DragEvent) {
        const dt = e.dataTransfer;
        const files = dt?.files;
        if (files) {
          handleFiles({ target: { files: files } } as unknown as Event);
        }
      }

      async function handleFiles(e: Event) {
        const target = e.target as HTMLInputElement;
        const files = target.files;
        if (!files || files.length === 0) return;

        const file = files[0];
        uploadFile(file);
      }

      async function uploadFile(file: File) {
        const formData = new FormData();
        formData.append("file", file);

        // Show loading state
        const originalText = uploadText!.innerText;
        uploadText!.innerText = `Uploading ${file.name}...`;

        try {
          const response = await fetch("/api/upload", {
            method: "POST",
            body: formData,
          });

          if (response.ok) {
            const result = await response.json();
            uploadText!.innerText = "Upload Successful!";
            // Reset after 3 seconds
            setTimeout(() => {
              uploadText!.innerText = originalText;
            }, 3000);
            // Optionally refresh list or redirect
          } else {
            uploadText!.innerText = "Upload Failed";
            console.error("Upload failed");
          }
        } catch (error) {
          uploadText!.innerText = "Error uploading file";
          console.error("Error:", error);
        }
      }
    }
  </script>
</div>

<style>
  .upload-glow:hover {
    box-shadow: 0 0 20px 2px rgba(0, 122, 255, 0.1);
  }
</style>
